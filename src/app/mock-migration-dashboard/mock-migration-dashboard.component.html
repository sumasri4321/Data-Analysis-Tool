<div class="min-h-screen bg-gray-100 p-6 font-inter antialiased">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    body {
      font-family: 'Inter', sans-serif;
    }

    .btn-primary {
      @apply bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75;
    }

    .btn-secondary {
      @apply bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-75;
    }

    /* Status specific styles */
    .status-success {
      @apply bg-green-50 border-green-200 text-green-700;
    }

    .status-partial-success {
      @apply bg-yellow-50 border-yellow-200 text-yellow-700;
    }

    .status-failed {
      @apply bg-red-50 border-red-200 text-red-700;
    }

    .status-unknown {
      @apply bg-gray-50 border-gray-200 text-gray-700;
    }
  </style>

  <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-8">
    <header class="text-center mb-10">
      <h1 class="text-4xl font-extrabold text-purple-800 mb-2">Analysis Dashboard</h1>
      <p class="text-lg text-gray-600">Review the data analysis status and configuration.</p>
    </header>

    <section *ngIf="migrationReport" class="mb-8 p-6 rounded-lg shadow-inner border"
             [ngClass]="getStatusClass(migrationReport.status)">
      <h2 class="text-2xl font-bold mb-4"
          [ngClass]="{
            'text-green-700': migrationReport.status === 'SUCCESS',
            'text-yellow-700': migrationReport.status === 'PARTIAL_SUCCESS',
            'text-red-700': migrationReport.status === 'FAILED'
          }">
        Analysis Status: {{ migrationReport.status }}
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700">
        <p><strong>Total Source Rows Processed:</strong> {{ migrationReport.totalSourceRowsProcessed }}</p>
        <p><strong>Rows Processed (Inserted):</strong> {{ migrationReport.rowsMigratedInserted }}</p>
        <p><strong>Rows Processed (Updated):</strong> {{ migrationReport.rowsMigratedUpdated }}</p>
        <p><strong>Rows Skipped (Primary Key Conflict):</strong> {{ migrationReport.rowsSkippedDueToPrimaryKeyConflict }}</p>
        <p><strong>Rows Skipped (No Mapping):</strong> {{ migrationReport.rowsSkippedDueToNoMapping }}</p>
        <p><strong>Rows Skipped (Identical Data):</strong> {{ migrationReport.rowsSkippedDueToIdenticalData }}</p>
      </div>

      <div *ngIf="migrationReport.messages.length > 0" class="mt-4">
        <h3 class="text-lg font-semibold text-gray-800">Messages:</h3>
        <ul class="list-disc list-inside text-sm text-gray-600">
          <li *ngFor="let msg of migrationReport.messages">{{ msg }}</li>
        </ul>
      </div>
      <div *ngIf="migrationReport.errors.length > 0" class="mt-4">
        <h3 class="text-lg font-semibold text-red-700">Errors:</h3>
        <ul class="list-disc list-inside text-sm text-red-600">
          <li *ngFor="let err of migrationReport.errors">{{ err }}</li>
        </ul>
      </div>

      <!-- NEW: SQL Queries Section -->
      <div *ngIf="migrationReport.executedQueries && migrationReport.executedQueries.length > 0" class="mt-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold text-gray-800">Executed SQL Queries ({{ migrationReport.executedQueries.length }})</h3>
          <button 
            (click)="downloadSqlQueries()" 
            class="btn-primary text-sm"
            [disabled]="isDownloading">
            <span *ngIf="!isDownloading">ðŸ“¥ Download as .sql file</span>
            <span *ngIf="isDownloading">Downloading...</span>
          </button>
        </div>
        
        <div class="max-h-96 overflow-y-auto bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm">
          <div *ngFor="let query of migrationReport.executedQueries; let i = index" class="mb-4 last:mb-0">
            <div class="text-gray-500 text-xs mb-1">-- Query {{ i + 1 }}</div>
            <pre class="whitespace-pre-wrap break-words">{{ query }}</pre>
          </div>
        </div>
        
        <div class="mt-2 text-sm text-gray-600">
          <p>ðŸ’¡ These queries can be used in your CI/CD pipeline for production deployment.</p>
          <p>The downloaded .sql file contains all queries with proper formatting and comments.</p>
        </div>
      </div>
    </section>

    <section *ngIf="migrationConfiguration" class="mb-8 p-6 bg-gray-50 rounded-lg shadow-inner border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-700 mb-4">Migration Configuration</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div>
          <h3 class="text-xl font-semibold text-blue-700 mb-2">Source Database</h3>
          <p class="text-gray-700"><strong>Name:</strong> {{ migrationConfiguration.sourceDbParams?.databaseName || 'N/A' }}</p>
          <p class="text-gray-700"><strong>Table:</strong> {{ migrationConfiguration.selectedSourceTableName || 'N/A' }}</p>
        </div>
        <div>
          <h3 class="text-xl font-semibold text-purple-700 mb-2">Destination Database</h3>
          <p class="text-gray-700"><strong>Name:</strong> {{ migrationConfiguration.destinationDbParams?.databaseName || 'N/A' }}</p>
          <p class="text-gray-700"><strong>Table:</strong> {{ migrationConfiguration.selectedDestinationTableName || 'N/A' }}</p>
        </div>
      </div>

      <h3 class="text-xl font-semibold text-gray-700 mb-3">Column Mappings:</h3>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 rounded-lg overflow-hidden">
          <thead class="bg-gray-100">
            <tr>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Source Column</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Destination Column</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Transformation</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr *ngFor="let mapping of migrationConfiguration.columnMappings">
              <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">
                {{ mapping.sourceColumn?.name || 'N/A' }} ({{ mapping.sourceColumn?.dataType || 'N/A' }})
                <span *ngIf="mapping.secondarySourceColumn" class="block text-xs text-gray-500">
                  + {{ mapping.secondarySourceColumn.name }} ({{ mapping.secondarySourceColumn.dataType }})
                </span>
              </td>
              <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">
                {{ mapping.destinationColumn?.name || 'N/A' }} ({{ mapping.destinationColumn?.dataType || 'N/A' }})
              </td>
              <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">
                <span *ngIf="mapping.transformationMode === 'NONE'" class="text-gray-500">None</span>
                <span *ngIf="mapping.transformationMode === 'SUGGESTED'" class="text-blue-600">
                  Suggested ({{ getSuggestedTransformationDisplayName(mapping.suggestedTransformationType) }})
                </span>
                <span *ngIf="mapping.transformationMode === 'CUSTOM_COMMAND'" class="text-purple-600">
                  Custom Command: <code class="bg-gray-200 p-1 rounded-md text-xs">{{ mapping.customCommand }}</code>
                </span>
              </td>
              <td class="px-4 py-2 whitespace-nowrap text-sm">
                <span *ngIf="mapping.isValid" class="text-green-600 font-semibold">Valid</span>
                <span *ngIf="!mapping.isValid" class="text-red-600 font-semibold">Invalid</span>
                <p *ngIf="mapping.validationMessage" class="text-xs text-gray-500">{{ mapping.validationMessage }}</p>
              </td>
            </tr>
            <tr *ngIf="migrationConfiguration.columnMappings.length === 0">
              <td colspan="4" class="px-4 py-3 text-center text-gray-500 italic">No column mappings configured.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <div class="text-center mt-8">
      <button (click)="startNewMigration()" class="btn-primary">Start New Migration</button>
    </div>
  </div>
</div>
